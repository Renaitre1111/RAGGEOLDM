## Conditional Generation

### Train the Conditional RAGGeoLDM

```bash
python /mnt/workspace/zhaoliangjie/raggeo-ldm/main_qm9.py --exp_name exp_cond_alpha --model egnn_dynamics --lr 0.0016 --nf 192 --n_layers 9 --save_model True --diffusion_steps 1000 --sin_embedding False --n_epochs 3000 --n_stability_samples 500 --diffusion_noise_schedule polynomial_2 --diffusion_noise_precision 1e-5 --dequantization deterministic --include_charges False --diffusion_loss_type l2 --batch_size 1024 --normalize_factors [1,8,1] --conditioning alpha --dataset qm9_second_half --train_diffusion --trainable_ae --latent_nf 1 --use_rag --rag_k 8 --chemberta_path /mnt/workspace/zhaoliangjie/raggeo-ldm/ChemBERTa --rag_mol_emb_dim 384 --rag_num_prop 1 --rag_agg_dim 128 --batch_size_chemberta 32 --num_workers 4 --no_wandb
```
```bash
python /mnt/workspace/zhaoliangjie/raggeo-ldm/main_qm9.py --exp_name exp_cond_gap --model egnn_dynamics --lr 4e-4 --nf 192 --n_layers 9 --save_model True --diffusion_steps 1000 --sin_embedding False --n_epochs 3000 --n_stability_samples 500 --diffusion_noise_schedule polynomial_2 --diffusion_noise_precision 1e-5 --dequantization deterministic --include_charges False --diffusion_loss_type l2 --batch_size 1024 --normalize_factors [1,8,1] --conditioning gap --dataset qm9_second_half --train_diffusion --trainable_ae --latent_nf 1 --use_rag --rag_k 8 --chemberta_path /mnt/workspace/zhaoliangjie/raggeo-ldm/ChemBERTa --rag_mol_emb_dim 384 --rag_num_prop 1 --rag_agg_dim 128 --batch_size_chemberta 32 --num_workers 4 --no_wandb
```
```bash
python /mnt/workspace/zhaoliangjie/raggeo-ldm/main_qm9.py --exp_name exp_cond_homo --model egnn_dynamics --lr 4e-4 --nf 192 --n_layers 9 --save_model True --diffusion_steps 1000 --sin_embedding False --n_epochs 3000 --n_stability_samples 500 --diffusion_noise_schedule polynomial_2 --diffusion_noise_precision 1e-5 --dequantization deterministic --include_charges False --diffusion_loss_type l2 --batch_size 1024 --normalize_factors [1,8,1] --conditioning homo --dataset qm9_second_half --train_diffusion --trainable_ae --latent_nf 1 --use_rag --rag_k 8 --chemberta_path /mnt/workspace/zhaoliangjie/raggeo-ldm/ChemBERTa --rag_mol_emb_dim 384 --rag_num_prop 1 --rag_agg_dim 128 --batch_size_chemberta 32 --num_workers 4 --no_wandb
```

The argument `--conditioning alpha` can be set to any of the following properties: `alpha`, `gap`, `homo`, `lumo`, `mu` `Cv`. The same applies to the following commands that also depend on alpha.

### Generate samples for different property values

```python eval_conditional_qm9.py --generators_path outputs/exp_cond_alpha --property alpha --n_sweeps 10 --task qualitative```

### Evaluate the Conditional RAGGeoLDM with property classifiers

#### Train a property classifier

```cd qm9/property_prediction```  
```python main_qm9_prop.py --num_workers 2 --lr 5e-4 --property alpha --exp_name exp_class_alpha --model_name egnn```

Additionally, you can change the argument `--model_name egnn` by `--model_name numnodes` to train a classifier baseline that classifies only based on the number of nodes.

#### Evaluate the generated samples

Evaluate the trained property classifier on the samples generated by the trained conditional GeoLDM model

```python eval_conditional_qm9.py --generators_path outputs/exp_cond_alpha --classifiers_path qm9/property_prediction/outputs/exp_class_alpha --property alpha  --iterations 100  --batch_size 100 --task edm```

